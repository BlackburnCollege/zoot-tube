<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Zoot Tube</title>
</head>
<body>

<a href="test.html">Test Page</a>

<div id="app">
    <button id="signInButton" onclick="onSignIn()">Sign in</button>
</div>

<script src="scripts/index.js"></script>

<script>
    let socket = new WebSocket('ws://localhost:8080');
    socket.onmessage = (messageWrapper) => {
        const stringMessage = messageWrapper.data;
        const asJSONObject = JSON.parse(stringMessage);
        let app = document.getElementById('app');
        let header = document.createElement('h1');
        header.innerText = asJSONObject.data;
        app.appendChild(header);
    };
    socket.onopen = () => {
        socket.send("Test!")
    };

    function onSignIn() {
        auth2.grantOfflineAccess().then(signInCallback).catch((err) => {
            console.log(err);
        });
    }
    function signInCallback(authResult) {
        if (authResult['code']) {
            let button = document.getElementById("signInButton");
            button.setAttribute("style", "display: none");
            socket.send(`{"code":"${authResult['code']}"`);
        } else {
            console.log("ERROR")
        }
    }
</script>
</body>
</html>