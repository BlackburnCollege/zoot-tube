<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Zoot Tube</title>
    <script src="https://apis.google.com/js/platform.js?onload=start" async defer></script>
    <script>
        function start() {
            gapi.load('auth2', function () {
                auth2 = gapi.auth2.init({
                    client_id: '991685953336-su9qrdbh9egc8une72a09qko04kd69md.apps.googleusercontent.com',
                    // Scopes to request in addition to 'profile' and 'email'
                    scope: 'https://www.googleapis.com/auth/youtube.force-ssl'
                });
            });
        }
    </script>
</head>
<body>

<a href="test.html">Test Page</a>

<div id="app">
    <button id="signInButton" onclick="onSignIn()">Sign in</button>
</div>

<script>
    let socket = new WebSocket('ws://localhost:8080');
    socket.onmessage = (messageWrapper) => {
        const stringMessage = messageWrapper.data;
        const asJSONObject = JSON.parse(stringMessage);
        let app = document.getElementById('app');
        let header = document.createElement('h1');
        header.innerText = asJSONObject.data;
        app.appendChild(header);
    };
    socket.onopen = () => {
        socket.send("Test!")
    };

    function onSignIn() {
        auth2.grantOfflineAccess().then(signInCallback).catch((err) => {
            console.log(err);
        });
    }
    function signInCallback(authResult) {
        if (authResult['code']) {
            let button = document.getElementById("signInButton");
            button.setAttribute("style", "display: none");
            socket.send(`{"code":"${authResult['code']}"`);
        } else {
            console.log("ERROR")
        }
    }
</script>
</body>
</html>